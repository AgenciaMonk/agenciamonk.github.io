'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _events = require('events');

var _events2 = _interopRequireDefault(_events);

var _stream = require('stream');

var _url = require('url');

var _url2 = _interopRequireDefault(_url);

var _arrayUniq = require('array-uniq');

var _arrayUniq2 = _interopRequireDefault(_arrayUniq);

var _arrayDiffer = require('array-differ');

var _arrayDiffer2 = _interopRequireDefault(_arrayDiffer);

var _easydate = require('easydate');

var _easydate2 = _interopRequireDefault(_easydate);

var _fsWriteStreamAtomic = require('fs-write-stream-atomic');

var _fsWriteStreamAtomic2 = _interopRequireDefault(_fsWriteStreamAtomic);

var _getRes = require('get-res');

var _getRes2 = _interopRequireDefault(_getRes);

var _logSymbols = require('log-symbols');

var _logSymbols2 = _interopRequireDefault(_logSymbols);

var _mem = require('mem');

var _mem2 = _interopRequireDefault(_mem);

var _mkdirp = require('mkdirp');

var _mkdirp2 = _interopRequireDefault(_mkdirp);

var _rimraf = require('rimraf');

var _rimraf2 = _interopRequireDefault(_rimraf);

var _screenshotStream = require('screenshot-stream');

var _screenshotStream2 = _interopRequireDefault(_screenshotStream);

var _viewportList = require('viewport-list');

var _viewportList2 = _interopRequireDefault(_viewportList);

var _protocolify = require('protocolify');

var _protocolify2 = _interopRequireDefault(_protocolify);

var _filenamify = require('filenamify');

var _filenamify2 = _interopRequireDefault(_filenamify);

var _filenamifyUrl = require('filenamify-url');

var _filenamifyUrl2 = _interopRequireDefault(_filenamifyUrl);

var _lodash = require('lodash.template');

var _lodash2 = _interopRequireDefault(_lodash);

var _pify = require('pify');

var _pify2 = _interopRequireDefault(_pify);

var _plur = require('plur');

var _plur2 = _interopRequireDefault(_plur);

var _unusedFilename = require('unused-filename');

var _unusedFilename2 = _interopRequireDefault(_unusedFilename);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const getResMem = (0, _mem2.default)(_getRes2.default);
const viewportListMem = (0, _mem2.default)(_viewportList2.default);

let listener;

class Pageres extends _events2.default {

	constructor(options) {
		super();

		this.options = (0, _assign2.default)({}, options);
		this.options.filename = this.options.filename || '<%= url %>-<%= size %><%= crop %>';
		this.options.format = this.options.format || 'png';
		this.options.incrementalName = this.options.incrementalName || false;

		this.stats = {};
		this.items = [];
		this.sizes = [];
		this.urls = [];
		this._src = [];
	}

	src(url, sizes, options) {
		if (url === undefined) {
			return this._src;
		}

		this._src.push({ url: url, sizes: sizes, options: options });
		return this;
	}

	dest(dir) {
		if (dir === undefined) {
			return this._dest;
		}

		this._dest = dir;
		return this;
	}

	run() {
		var _this = this;

		return (0, _asyncToGenerator3.default)(function* () {
			yield _promise2.default.all(_this.src().map(function (src) {
				// eslint-disable-line array-callback-return
				const options = (0, _assign2.default)({}, _this.options, src.options);
				const sizes = (0, _arrayUniq2.default)(src.sizes.filter(/./.test, /^\d{2,4}x\d{2,4}$/i));
				const keywords = (0, _arrayDiffer2.default)(src.sizes, sizes);

				if (!src.url) {
					throw new Error('URL required');
				}

				_this.urls.push(src.url);

				if (sizes.length === 0 && keywords.indexOf('w3counter') !== -1) {
					return _this.resolution(src.url, options);
				}

				if (keywords.length > 0) {
					return _this.viewport({ url: src.url, sizes: sizes, keywords: keywords }, options);
				}

				for (const size of sizes) {
					_this.sizes.push(size);
					_this.items.push(_this.create(src.url, size, options));
				}
			}));

			_this.stats.urls = (0, _arrayUniq2.default)(_this.urls).length;
			_this.stats.sizes = (0, _arrayUniq2.default)(_this.sizes).length;
			_this.stats.screenshots = _this.items.length;

			if (!_this.dest()) {
				return _this.items;
			}

			yield _this.save(_this.items);

			return _this.items;
		})();
	}

	resolution(url, options) {
		var _this2 = this;

		return (0, _asyncToGenerator3.default)(function* () {
			for (const item of yield getResMem()) {
				_this2.sizes.push(item.item);
				_this2.items.push(_this2.create(url, item.item, options));
			}
		})();
	}

	viewport(obj, options) {
		var _this3 = this;

		return (0, _asyncToGenerator3.default)(function* () {
			for (const item of yield viewportListMem(obj.keywords)) {
				_this3.sizes.push(item.size);
				obj.sizes.push(item.size);
			}

			for (const size of (0, _arrayUniq2.default)(obj.sizes)) {
				_this3.items.push(_this3.create(obj.url, size, options));
			}
		})();
	}

	save(streams) {
		var _this4 = this;

		const files = [];

		const end = () => _promise2.default.all(files.map(file => (0, _pify2.default)(_rimraf2.default)(file)));

		if (!listener) {
			listener = process.on('SIGINT', (0, _asyncToGenerator3.default)(function* () {
				yield end();
				process.exit(1);
			}));
		}

		return _promise2.default.all(streams.map(stream => new _promise2.default((() => {
			var _ref2 = (0, _asyncToGenerator3.default)(function* (resolve, reject) {
				yield (0, _pify2.default)(_mkdirp2.default)(_this4.dest());

				const dest = _path2.default.join(_this4.dest(), stream.filename);
				const write = (0, _fsWriteStreamAtomic2.default)(dest);

				files.push(write.__atomicTmp);

				stream.on('warning', _this4.emit.bind(_this4, 'warning'));
				stream.on('warn', _this4.emit.bind(_this4, 'warn'));
				stream.on('error', (() => {
					var _ref3 = (0, _asyncToGenerator3.default)(function* (err) {
						yield end();
						reject(err);
					});

					return function (_x3) {
						return _ref3.apply(this, arguments);
					};
				})());

				write.on('finish', resolve);
				write.on('error', (() => {
					var _ref4 = (0, _asyncToGenerator3.default)(function* (err) {
						yield end();
						reject(err);
					});

					return function (_x4) {
						return _ref4.apply(this, arguments);
					};
				})());

				stream.pipe(write);
			});

			return function (_x, _x2) {
				return _ref2.apply(this, arguments);
			};
		})())));
	}

	create(uri, size, options) {
		const sizes = size.split('x');
		const stream = (0, _screenshotStream2.default)((0, _protocolify2.default)(uri), size, options);

		// Coercing to string here to please Flow
		// TODO: Should fix the Flow type so this isn't necessary
		const filename = (0, _lodash2.default)(`${String(options.filename)}.${String(options.format)}`);

		let hash = _url2.default.parse(uri).hash || '';

		if (_path2.default.isAbsolute(uri)) {
			uri = _path2.default.basename(uri);
		}

		// Strip empty hash fragments: `#` `#/` `#!/`
		if (/^#!?\/?$/.test(hash)) {
			hash = '';
		}

		stream.filename = filename({
			crop: options.crop ? '-cropped' : '',
			date: (0, _easydate2.default)('Y-M-d'),
			time: (0, _easydate2.default)('h-m-s'),
			size: size,
			width: sizes[0],
			height: sizes[1],
			url: (0, _filenamifyUrl2.default)(uri) + (0, _filenamify2.default)(hash)
		});

		if (options.incrementalName) {
			stream.filename = _unusedFilename2.default.sync(stream.filename);
		}

		return stream;
	}

	successMessage() {
		const stats = this.stats;
		const screenshots = stats.screenshots,
		      sizes = stats.sizes,
		      urls = stats.urls;

		const words = {
			screenshots: (0, _plur2.default)('screenshot', screenshots),
			sizes: (0, _plur2.default)('size', sizes),
			urls: (0, _plur2.default)('url', urls)
		};

		console.log(`\n${_logSymbols2.default.success} Generated ${screenshots} ${words.screenshots} from ${urls} ${words.urls} and ${sizes} ${words.sizes}`);
	}
}
exports.default = Pageres;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9pbmRleC5qcyJdLCJuYW1lcyI6WyJnZXRSZXNNZW0iLCJ2aWV3cG9ydExpc3RNZW0iLCJsaXN0ZW5lciIsIlBhZ2VyZXMiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJmaWxlbmFtZSIsImZvcm1hdCIsImluY3JlbWVudGFsTmFtZSIsInN0YXRzIiwiaXRlbXMiLCJzaXplcyIsInVybHMiLCJfc3JjIiwic3JjIiwidXJsIiwidW5kZWZpbmVkIiwicHVzaCIsImRlc3QiLCJkaXIiLCJfZGVzdCIsInJ1biIsImFsbCIsIm1hcCIsImZpbHRlciIsInRlc3QiLCJrZXl3b3JkcyIsIkVycm9yIiwibGVuZ3RoIiwiaW5kZXhPZiIsInJlc29sdXRpb24iLCJ2aWV3cG9ydCIsInNpemUiLCJjcmVhdGUiLCJzY3JlZW5zaG90cyIsInNhdmUiLCJpdGVtIiwib2JqIiwic3RyZWFtcyIsImZpbGVzIiwiZW5kIiwiZmlsZSIsInByb2Nlc3MiLCJvbiIsImV4aXQiLCJzdHJlYW0iLCJyZXNvbHZlIiwicmVqZWN0Iiwiam9pbiIsIndyaXRlIiwiX19hdG9taWNUbXAiLCJlbWl0IiwiYmluZCIsImVyciIsInBpcGUiLCJ1cmkiLCJzcGxpdCIsIlN0cmluZyIsImhhc2giLCJwYXJzZSIsImlzQWJzb2x1dGUiLCJiYXNlbmFtZSIsImNyb3AiLCJkYXRlIiwidGltZSIsIndpZHRoIiwiaGVpZ2h0Iiwic3luYyIsInN1Y2Nlc3NNZXNzYWdlIiwid29yZHMiLCJjb25zb2xlIiwibG9nIiwic3VjY2VzcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7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T0FBVCxDQUhvQjtBQUkxQmhDLGFBSjBCO0FBSzFCaUMsVUFBT3RELE1BQU0sQ0FBTixDQUxtQjtBQU0xQnVELFdBQVF2RCxNQUFNLENBQU4sQ0FOa0I7QUFPMUJJLFFBQUssNkJBQWN3QyxHQUFkLElBQXFCLDBCQUFXRyxJQUFYO0FBUEEsR0FBVCxDQUFsQjs7QUFVQSxNQUFJckQsUUFBUUcsZUFBWixFQUE2QjtBQUM1QnFDLFVBQU92QyxRQUFQLEdBQWtCLHlCQUFlNkQsSUFBZixDQUFvQnRCLE9BQU92QyxRQUEzQixDQUFsQjtBQUNBOztBQUVELFNBQU91QyxNQUFQO0FBQ0E7O0FBRUR1QixrQkFBaUI7QUFDaEIsUUFBTTNELFFBQVEsS0FBS0EsS0FBbkI7QUFEZ0IsUUFFVHlCLFdBRlMsR0FFbUJ6QixLQUZuQixDQUVUeUIsV0FGUztBQUFBLFFBRUl2QixLQUZKLEdBRW1CRixLQUZuQixDQUVJRSxLQUZKO0FBQUEsUUFFV0MsSUFGWCxHQUVtQkgsS0FGbkIsQ0FFV0csSUFGWDs7QUFHaEIsUUFBTXlELFFBQVE7QUFDYm5DLGdCQUFhLG9CQUFLLFlBQUwsRUFBbUJBLFdBQW5CLENBREE7QUFFYnZCLFVBQU8sb0JBQUssTUFBTCxFQUFhQSxLQUFiLENBRk07QUFHYkMsU0FBTSxvQkFBSyxLQUFMLEVBQVlBLElBQVo7QUFITyxHQUFkOztBQU1BMEQsVUFBUUMsR0FBUixDQUFhLEtBQUkscUJBQVdDLE9BQVEsY0FBYXRDLFdBQVksSUFBR21DLE1BQU1uQyxXQUFZLFNBQVF0QixJQUFLLElBQUd5RCxNQUFNekQsSUFBSyxRQUFPRCxLQUFNLElBQUcwRCxNQUFNMUQsS0FBTSxFQUF6STtBQUNBO0FBMUxtRTtrQkFBaERSLE8iLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQge1JlYWRhYmxlfSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHVybCBmcm9tICd1cmwnO1xuaW1wb3J0IGFycmF5VW5pcSBmcm9tICdhcnJheS11bmlxJztcbmltcG9ydCBhcnJheURpZmZlciBmcm9tICdhcnJheS1kaWZmZXInO1xuaW1wb3J0IGVhc3lkYXRlIGZyb20gJ2Vhc3lkYXRlJztcbmltcG9ydCBmc1dyaXRlU3RyZWFtQXRvbWljIGZyb20gJ2ZzLXdyaXRlLXN0cmVhbS1hdG9taWMnO1xuaW1wb3J0IGdldFJlcyBmcm9tICdnZXQtcmVzJztcbmltcG9ydCBsb2dTeW1ib2xzIGZyb20gJ2xvZy1zeW1ib2xzJztcbmltcG9ydCBtZW0gZnJvbSAnbWVtJztcbmltcG9ydCBta2RpcnAgZnJvbSAnbWtkaXJwJztcbmltcG9ydCByaW1yYWYgZnJvbSAncmltcmFmJztcbmltcG9ydCBzY3JlZW5zaG90U3RyZWFtIGZyb20gJ3NjcmVlbnNob3Qtc3RyZWFtJztcbmltcG9ydCB2aWV3cG9ydExpc3QgZnJvbSAndmlld3BvcnQtbGlzdCc7XG5pbXBvcnQgcHJvdG9jb2xpZnkgZnJvbSAncHJvdG9jb2xpZnknO1xuaW1wb3J0IGZpbGVuYW1pZnkgZnJvbSAnZmlsZW5hbWlmeSc7XG5pbXBvcnQgZmlsZW5hbWlmeVVybCBmcm9tICdmaWxlbmFtaWZ5LXVybCc7XG5pbXBvcnQgdGVtcGxhdGUgZnJvbSAnbG9kYXNoLnRlbXBsYXRlJztcbmltcG9ydCBwaWZ5IGZyb20gJ3BpZnknO1xuaW1wb3J0IHBsdXIgZnJvbSAncGx1cic7XG5pbXBvcnQgdW51c2VkRmlsZW5hbWUgZnJvbSAndW51c2VkLWZpbGVuYW1lJztcblxudHlwZSBQYWdlcmVzU3RyZWFtID0gUmVhZGFibGUgJiB7ZmlsZW5hbWU6IHN0cmluZ307XG5cbnR5cGUgT3B0aW9ucyA9IHtcblx0ZGVsYXk/OiBudW1iZXI7XG5cdHRpbWVvdXQ/OiBudW1iZXI7XG5cdGNyb3A/OiBib29sZWFuO1xuXHRpbmNyZW1lbnRhbE5hbWU/OiBib29sZWFuO1xuXHRjc3M/OiBzdHJpbmc7XG5cdGNvb2tpZXM/OiBBcnJheTxzdHJpbmc+IHwge1trZXk6IHN0cmluZ106IHN0cmluZ307XG5cdGZpbGVuYW1lPzogc3RyaW5nO1xuXHRzZWxlY3Rvcj86IHN0cmluZztcblx0aGlkZT86IEFycmF5PHN0cmluZz47XG5cdHVzZXJuYW1lPzogc3RyaW5nO1xuXHRwYXNzd29yZD86IHN0cmluZztcblx0c2NhbGU/OiBudW1iZXI7XG5cdGZvcm1hdD86IHN0cmluZztcblx0dXNlckFnZW50Pzogc3RyaW5nO1xuXHRoZWFkZXJzPzoge1trZXk6IHN0cmluZ106IHN0cmluZ307XG59O1xuXG50eXBlIFNyYyA9IHtcblx0dXJsOiBzdHJpbmc7XG5cdHNpemVzOiBBcnJheTxzdHJpbmc+O1xuXHRvcHRpb25zOiBPcHRpb25zO1xufTtcblxudHlwZSBWaWV3cG9ydCA9IHtcblx0dXJsOiBzdHJpbmc7XG5cdHNpemVzOiBBcnJheTxzdHJpbmc+O1xuXHRrZXl3b3JkczogQXJyYXk8c3RyaW5nPjtcbn07XG5cbnR5cGUgU3JjRm48RGVzdFZhbHVlPiA9XG5cdCYgKChfOiB2b2lkLCBfOiB2b2lkLCBfOiB2b2lkKSA9PiBBcnJheTxTcmM+KVxuXHQmICgodXJsOiBzdHJpbmcsIHNpemVzOiBBcnJheTxzdHJpbmc+LCBvcHRpb25zOiBPcHRpb25zKSA9PiBQYWdlcmVzPERlc3RWYWx1ZT4pO1xuXG50eXBlIERlc3RGbjxEZXN0VmFsdWU+ID1cblx0JiAoKF86IHZvaWQpID0+IERlc3RWYWx1ZSlcblx0JiAoKGRpcjogRGVzdFZhbHVlKSA9PiBQYWdlcmVzPERlc3RWYWx1ZT4pO1xuXG5jb25zdCBnZXRSZXNNZW0gPSBtZW0oZ2V0UmVzKTtcbmNvbnN0IHZpZXdwb3J0TGlzdE1lbSA9IG1lbSh2aWV3cG9ydExpc3QpO1xuXG5sZXQgbGlzdGVuZXI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhZ2VyZXM8RGVzdFZhbHVlOiBzdHJpbmc+IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcblx0b3B0aW9uczogT3B0aW9ucztcblx0c3RhdHM6IE9iamVjdDtcblx0aXRlbXM6IEFycmF5PFBhZ2VyZXNTdHJlYW0+O1xuXHRzaXplczogQXJyYXk8c3RyaW5nPjtcblx0dXJsczogQXJyYXk8c3RyaW5nPjtcblx0X3NyYzogQXJyYXk8U3JjPjtcblx0X2Rlc3Q6IERlc3RWYWx1ZTtcblxuXHRjb25zdHJ1Y3RvcihvcHRpb25zOiBPcHRpb25zKSB7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuXHRcdHRoaXMub3B0aW9ucy5maWxlbmFtZSA9IHRoaXMub3B0aW9ucy5maWxlbmFtZSB8fCAnPCU9IHVybCAlPi08JT0gc2l6ZSAlPjwlPSBjcm9wICU+Jztcblx0XHR0aGlzLm9wdGlvbnMuZm9ybWF0ID0gdGhpcy5vcHRpb25zLmZvcm1hdCB8fCAncG5nJztcblx0XHR0aGlzLm9wdGlvbnMuaW5jcmVtZW50YWxOYW1lID0gdGhpcy5vcHRpb25zLmluY3JlbWVudGFsTmFtZSB8fCBmYWxzZTtcblxuXHRcdHRoaXMuc3RhdHMgPSB7fTtcblx0XHR0aGlzLml0ZW1zID0gW107XG5cdFx0dGhpcy5zaXplcyA9IFtdO1xuXHRcdHRoaXMudXJscyA9IFtdO1xuXHRcdHRoaXMuX3NyYyA9IFtdO1xuXHR9XG5cblx0c3JjOiBTcmNGbjxEZXN0VmFsdWU+O1xuXHRzcmModXJsOiBzdHJpbmcsIHNpemVzOiBBcnJheTxzdHJpbmc+LCBvcHRpb25zOiBPcHRpb25zKSB7XG5cdFx0aWYgKHVybCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3JjO1xuXHRcdH1cblxuXHRcdHRoaXMuX3NyYy5wdXNoKHt1cmwsIHNpemVzLCBvcHRpb25zfSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRkZXN0OiBEZXN0Rm48RGVzdFZhbHVlPjtcblx0ZGVzdChkaXI6IERlc3RWYWx1ZSkge1xuXHRcdGlmIChkaXIgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc3Q7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZGVzdCA9IGRpcjtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdGFzeW5jIHJ1bigpOiBQcm9taXNlPFBhZ2VyZXNTdHJlYW1bXT4ge1xuXHRcdGF3YWl0IFByb21pc2UuYWxsKHRoaXMuc3JjKCkubWFwKHNyYyA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgYXJyYXktY2FsbGJhY2stcmV0dXJuXG5cdFx0XHRjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLCBzcmMub3B0aW9ucyk7XG5cdFx0XHRjb25zdCBzaXplcyA9IGFycmF5VW5pcShzcmMuc2l6ZXMuZmlsdGVyKC8uLy50ZXN0LCAvXlxcZHsyLDR9eFxcZHsyLDR9JC9pKSk7XG5cdFx0XHRjb25zdCBrZXl3b3JkcyA9IGFycmF5RGlmZmVyKHNyYy5zaXplcywgc2l6ZXMpO1xuXG5cdFx0XHRpZiAoIXNyYy51cmwpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVUkwgcmVxdWlyZWQnKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy51cmxzLnB1c2goc3JjLnVybCk7XG5cblx0XHRcdGlmIChzaXplcy5sZW5ndGggPT09IDAgJiYga2V5d29yZHMuaW5kZXhPZigndzNjb3VudGVyJykgIT09IC0xKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnJlc29sdXRpb24oc3JjLnVybCwgb3B0aW9ucyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChrZXl3b3Jkcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnZpZXdwb3J0KHt1cmw6IHNyYy51cmwsIHNpemVzLCBrZXl3b3Jkc30sIG9wdGlvbnMpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGNvbnN0IHNpemUgb2Ygc2l6ZXMpIHtcblx0XHRcdFx0dGhpcy5zaXplcy5wdXNoKHNpemUpO1xuXHRcdFx0XHR0aGlzLml0ZW1zLnB1c2godGhpcy5jcmVhdGUoc3JjLnVybCwgc2l6ZSwgb3B0aW9ucykpO1xuXHRcdFx0fVxuXHRcdH0pKTtcblxuXHRcdHRoaXMuc3RhdHMudXJscyA9IGFycmF5VW5pcSh0aGlzLnVybHMpLmxlbmd0aDtcblx0XHR0aGlzLnN0YXRzLnNpemVzID0gYXJyYXlVbmlxKHRoaXMuc2l6ZXMpLmxlbmd0aDtcblx0XHR0aGlzLnN0YXRzLnNjcmVlbnNob3RzID0gdGhpcy5pdGVtcy5sZW5ndGg7XG5cblx0XHRpZiAoIXRoaXMuZGVzdCgpKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5pdGVtcztcblx0XHR9XG5cblx0XHRhd2FpdCB0aGlzLnNhdmUodGhpcy5pdGVtcyk7XG5cblx0XHRyZXR1cm4gdGhpcy5pdGVtcztcblx0fVxuXG5cdGFzeW5jIHJlc29sdXRpb24odXJsOiBzdHJpbmcsIG9wdGlvbnM6IE9wdGlvbnMpIHtcblx0XHRmb3IgKGNvbnN0IGl0ZW0gb2YgYXdhaXQgZ2V0UmVzTWVtKCkpIHtcblx0XHRcdHRoaXMuc2l6ZXMucHVzaChpdGVtLml0ZW0pO1xuXHRcdFx0dGhpcy5pdGVtcy5wdXNoKHRoaXMuY3JlYXRlKHVybCwgaXRlbS5pdGVtLCBvcHRpb25zKSk7XG5cdFx0fVxuXHR9XG5cblx0YXN5bmMgdmlld3BvcnQob2JqOiBWaWV3cG9ydCwgb3B0aW9uczogT3B0aW9ucykge1xuXHRcdGZvciAoY29uc3QgaXRlbSBvZiBhd2FpdCB2aWV3cG9ydExpc3RNZW0ob2JqLmtleXdvcmRzKSkge1xuXHRcdFx0dGhpcy5zaXplcy5wdXNoKGl0ZW0uc2l6ZSk7XG5cdFx0XHRvYmouc2l6ZXMucHVzaChpdGVtLnNpemUpO1xuXHRcdH1cblxuXHRcdGZvciAoY29uc3Qgc2l6ZSBvZiBhcnJheVVuaXEob2JqLnNpemVzKSkge1xuXHRcdFx0dGhpcy5pdGVtcy5wdXNoKHRoaXMuY3JlYXRlKG9iai51cmwsIHNpemUsIG9wdGlvbnMpKTtcblx0XHR9XG5cdH1cblxuXHRzYXZlKHN0cmVhbXM6IEFycmF5PFBhZ2VyZXNTdHJlYW0+KSB7XG5cdFx0Y29uc3QgZmlsZXMgPSBbXTtcblxuXHRcdGNvbnN0IGVuZCA9ICgpID0+IFByb21pc2UuYWxsKGZpbGVzLm1hcChmaWxlID0+IHBpZnkocmltcmFmKShmaWxlKSkpO1xuXG5cdFx0aWYgKCFsaXN0ZW5lcikge1xuXHRcdFx0bGlzdGVuZXIgPSBwcm9jZXNzLm9uKCdTSUdJTlQnLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRcdGF3YWl0IGVuZCgpO1xuXHRcdFx0XHRwcm9jZXNzLmV4aXQoMSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwoc3RyZWFtcy5tYXAoc3RyZWFtID0+XG5cdFx0XHRuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGF3YWl0IHBpZnkobWtkaXJwKSh0aGlzLmRlc3QoKSk7XG5cblx0XHRcdFx0Y29uc3QgZGVzdCA9IHBhdGguam9pbih0aGlzLmRlc3QoKSwgc3RyZWFtLmZpbGVuYW1lKTtcblx0XHRcdFx0Y29uc3Qgd3JpdGUgPSBmc1dyaXRlU3RyZWFtQXRvbWljKGRlc3QpO1xuXG5cdFx0XHRcdGZpbGVzLnB1c2god3JpdGUuX19hdG9taWNUbXApO1xuXG5cdFx0XHRcdHN0cmVhbS5vbignd2FybmluZycsIHRoaXMuZW1pdC5iaW5kKHRoaXMsICd3YXJuaW5nJykpO1xuXHRcdFx0XHRzdHJlYW0ub24oJ3dhcm4nLCB0aGlzLmVtaXQuYmluZCh0aGlzLCAnd2FybicpKTtcblx0XHRcdFx0c3RyZWFtLm9uKCdlcnJvcicsIGFzeW5jIGVyciA9PiB7XG5cdFx0XHRcdFx0YXdhaXQgZW5kKCk7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHdyaXRlLm9uKCdmaW5pc2gnLCByZXNvbHZlKTtcblx0XHRcdFx0d3JpdGUub24oJ2Vycm9yJywgYXN5bmMgZXJyID0+IHtcblx0XHRcdFx0XHRhd2FpdCBlbmQoKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c3RyZWFtLnBpcGUod3JpdGUpO1xuXHRcdFx0fSlcblx0XHQpKTtcblx0fVxuXG5cdGNyZWF0ZSh1cmk6IHN0cmluZywgc2l6ZTogc3RyaW5nLCBvcHRpb25zOiBPcHRpb25zKSB7XG5cdFx0Y29uc3Qgc2l6ZXMgPSBzaXplLnNwbGl0KCd4Jyk7XG5cdFx0Y29uc3Qgc3RyZWFtID0gc2NyZWVuc2hvdFN0cmVhbShwcm90b2NvbGlmeSh1cmkpLCBzaXplLCBvcHRpb25zKTtcblxuXHRcdC8vIENvZXJjaW5nIHRvIHN0cmluZyBoZXJlIHRvIHBsZWFzZSBGbG93XG5cdFx0Ly8gVE9ETzogU2hvdWxkIGZpeCB0aGUgRmxvdyB0eXBlIHNvIHRoaXMgaXNuJ3QgbmVjZXNzYXJ5XG5cdFx0Y29uc3QgZmlsZW5hbWUgPSB0ZW1wbGF0ZShgJHtTdHJpbmcob3B0aW9ucy5maWxlbmFtZSl9LiR7U3RyaW5nKG9wdGlvbnMuZm9ybWF0KX1gKTtcblxuXHRcdGxldCBoYXNoID0gdXJsLnBhcnNlKHVyaSkuaGFzaCB8fCAnJztcblxuXHRcdGlmIChwYXRoLmlzQWJzb2x1dGUodXJpKSkge1xuXHRcdFx0dXJpID0gcGF0aC5iYXNlbmFtZSh1cmkpO1xuXHRcdH1cblxuXHRcdC8vIFN0cmlwIGVtcHR5IGhhc2ggZnJhZ21lbnRzOiBgI2AgYCMvYCBgIyEvYFxuXHRcdGlmICgvXiMhP1xcLz8kLy50ZXN0KGhhc2gpKSB7XG5cdFx0XHRoYXNoID0gJyc7XG5cdFx0fVxuXG5cdFx0c3RyZWFtLmZpbGVuYW1lID0gZmlsZW5hbWUoe1xuXHRcdFx0Y3JvcDogb3B0aW9ucy5jcm9wID8gJy1jcm9wcGVkJyA6ICcnLFxuXHRcdFx0ZGF0ZTogZWFzeWRhdGUoJ1ktTS1kJyksXG5cdFx0XHR0aW1lOiBlYXN5ZGF0ZSgnaC1tLXMnKSxcblx0XHRcdHNpemUsXG5cdFx0XHR3aWR0aDogc2l6ZXNbMF0sXG5cdFx0XHRoZWlnaHQ6IHNpemVzWzFdLFxuXHRcdFx0dXJsOiBmaWxlbmFtaWZ5VXJsKHVyaSkgKyBmaWxlbmFtaWZ5KGhhc2gpXG5cdFx0fSk7XG5cblx0XHRpZiAob3B0aW9ucy5pbmNyZW1lbnRhbE5hbWUpIHtcblx0XHRcdHN0cmVhbS5maWxlbmFtZSA9IHVudXNlZEZpbGVuYW1lLnN5bmMoc3RyZWFtLmZpbGVuYW1lKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc3RyZWFtO1xuXHR9XG5cblx0c3VjY2Vzc01lc3NhZ2UoKSB7XG5cdFx0Y29uc3Qgc3RhdHMgPSB0aGlzLnN0YXRzO1xuXHRcdGNvbnN0IHtzY3JlZW5zaG90cywgc2l6ZXMsIHVybHN9ID0gc3RhdHM7XG5cdFx0Y29uc3Qgd29yZHMgPSB7XG5cdFx0XHRzY3JlZW5zaG90czogcGx1cignc2NyZWVuc2hvdCcsIHNjcmVlbnNob3RzKSxcblx0XHRcdHNpemVzOiBwbHVyKCdzaXplJywgc2l6ZXMpLFxuXHRcdFx0dXJsczogcGx1cigndXJsJywgdXJscylcblx0XHR9O1xuXG5cdFx0Y29uc29sZS5sb2coYFxcbiR7bG9nU3ltYm9scy5zdWNjZXNzfSBHZW5lcmF0ZWQgJHtzY3JlZW5zaG90c30gJHt3b3Jkcy5zY3JlZW5zaG90c30gZnJvbSAke3VybHN9ICR7d29yZHMudXJsc30gYW5kICR7c2l6ZXN9ICR7d29yZHMuc2l6ZXN9YCk7XG5cdH1cbn1cbiJdfQ==